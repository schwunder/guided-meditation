# Refactor Practices
- **Guardrails from previous passes** — keep flow declarative so `runSequence` steps the sequence and `presentSequenceItem` stays the sole presenter; let CSS own dwell and fade timing via `--checkpoint-hold-ms` and `--transition-duration-fade`, with JavaScript reading them only; centralize stage swaps in `activateStage` so fade removal and state reset never scatter; cache DOM elements with `ensureMediaEntry`, calling `resetMedia` before activation; wait for the CSS fade duration before removing stages so JS and transitions stay aligned; favor element reuse over recreation unless artifacts resurface; use CSS sizing limits (viewport ratios) over JS resize listeners unless script control is essential.
- **Next refactor targets** — extend `buildStage` to accept an options object (media element plus metadata) so alt text and caption overrides remain localized; wrap `preloadSequenceAssets()` and `runSequence()` in an error boundary that renders a user-facing fallback when assets fail; generalize the Bun dev server to serve any file under `public/`, eliminating bespoke cases as JSON/audio assets appear; capture stage lifecycle metrics (e.g., CSS fade vs. JS fallback deltas) so regressions surface during refactors.

