# Cursor Rules for Guided Meditation Project

## Project Overview
Interactive guided meditation experience with static HTML sequences, lightweight CSS, and a lean JavaScript controller. Uses Bun server, Biome.js for linting/formatting, and Mermaid for diagrams.

## Code Style & Formatting

### Biome.js Configuration
- Use Biome.js for linting and formatting (configured in `biome.json`)
- Indent style: spaces (2 spaces)
- Line width: 100 characters
- Follow Biome's recommended rules

### JavaScript Conventions
- All JavaScript is inline in `public/index.html` (~201 lines in `<script>` block)
- Uses `SCENES` array with 8 scenes ('one' through 'eight')
- Scene structure: `{ id, phases: { intro, transition, outro } }`
- Prefer explicit `if` blocks over ternaries for readability
- Use Map for media caching (`mediaCache`)
- Minimal logging: only `console.error` for actual failures
- No JSON fetching - all scene data defined inline

### CSS Conventions
- All styling in CSS (~62 lines in `<style>` block), not inline styles or JS mutations
- Use CSS custom properties for timing and theming
- Scene-specific theming via `:root[data-scene="N"]` attributes (sets `--hue`, `--sat`, `--lum`)
- CSS variables: `--hue`, `--sat`, `--lum`, `--breath`, `--surface-bg`, `--caption-bg`, `--text`, `--shadow`

## File Organization

### Project Structure
```
public/
├── index.html              # Single file with all code inline (303 lines: ~62 CSS + ~201 JS)
└── assets/                 # Media assets (checkpoints, transitions)
    ├── checkpoints/        # Still images (1-1.png through 8-2.png)
    └── transitions/        # Video clips (1.mp4, 2a.mp4, 2b.mp4, etc.)

notes/                      # Detailed development documentation
├── features.md            # Implemented and planned features (including 7-chakra vision)
├── fix.md                 # Outstanding fixes
├── context.md             # Browser constraints and technical context
├── cursor-setup.md        # Cursor IDE setup guide
└── refactor.md            # Architecture principles and refactor notes

.claude/                    # Claude Code integration
├── hooks/                  # Automated event hooks
└── skills/                 # Specialized agent skills

mermaid/                   # Mermaid diagram files (.mmd or .md)

.cursor/                    # Cursor IDE configuration
biome.json                  # Biome.js configuration
server.js                   # Bun HTTP server (23 lines)
```

### Scene Structure
- 8 scenes defined in JavaScript `SCENES` array: 'one' through 'eight'
- Each scene has `{ id, phases: { intro, transition, outro } }`
- Step types:
  - Simple: `{ type, src, caption }` - single asset
  - Interactive: `{ type, left, right, choiceKey, captionLeft, captionRight }` - user chooses path
  - Conditional: `{ type, left, right, dependsOn }` - follows previous choice
- Theming via CSS `:root[data-scene="1"]` through `:root[data-scene="8"]` attributes
- Plan for 7 chakra sequences (see `notes/features.md`)

### Documentation Files
- Keep `README.md` and `CLAUDE.md` in root
- Detailed docs in `notes/` folder
- Use lowercase filenames for consistency (`context.md` not `CONTEXT.md`)
- Mermaid diagrams go in `mermaid/` folder

## Git & Version Control

### .gitignore Patterns
- System files: `.DS_Store`, `Thumbs.db`, etc.
- IDE files: `.vscode/`, `.idea/`, swap files
- Dependencies: `node_modules/`
- Environment: `.env`, `.env.local`
- Assets: `public/assets/` (if large media files)
- Archive: `public/archive/`
- Claude config: `.claude/`

## Mermaid Diagrams

### Diagram Support
- Store Mermaid diagrams in `mermaid/` folder
- Use `.mmd` extension for pure Mermaid files
- Can embed in `.md` files using ```mermaid code blocks
- Reference diagrams in documentation with relative paths

### Common Diagram Types
- Architecture diagrams (component interactions)
- Data flow diagrams (timeline iterator, media factory)
- Stage lifecycle diagrams
- Sequence flowcharts

## Development Workflow

### Static HTML Approach
- Sequences are hard-coded in `public/index.html`
- No JSON fetches or template cloning at runtime
- Update checkpoint copy, media references, or layout directly in HTML
- CSS handles all visual transitions and animations

### Error Handling
- Quiet error handling by design
- Only log with `console.error` when action truly fails
- Missing elements, media load failures → log and continue
- No verbose success banners or diagnostics

### Server Expectations
- `server.js` serves static files only
- No dynamic endpoints or metadata JSON
- Bun-based HTTP server

## Browser Compatibility

### Target Browsers
- Chrome/Edge (latest)
- Firefox (latest)
- Safari (latest macOS/iOS)

### Requirements
- ES2020 support (async generators, optional chaining)
- CSS custom properties
- HTML5 video/audio
- Template element
- Fetch API

### Edge Cases
- Video autoplay policies (requires muted + user gesture fallback)
- Large video preloading (network dependent)
- CSS backdrop-filter support (Safari needs `-webkit-`)
- Mobile video playback (needs `playsinline` attribute)

## Code Quality

### When Editing
- Keep `public/index.html` concise (~300 lines total)
- Keep JavaScript in `<script>` block around ~200 lines
- Extract complex logic to CSS when possible
- Prefer CSS classes over inline styles
- Maintain CSS variables contract

### Linting
- Biome.js runs automatically (if configured)
- Follow recommended rules
- Fix linting errors before committing

## Asset Management

### Asset Organization
```
public/assets/
├── checkpoints/     # Still images for meditation pauses
├── transitions/     # Video clips between checkpoints
├── chakras/         # Chakra-specific imagery
└── archive/         # Experimental or unused assets
```

### Naming Convention
- Checkpoints: `{scene}-{phase}.png` (e.g., `1-1.png`, `2-2a.png`, `2-2b.png`)
- Transitions: `{scene}{variant}.mp4` (e.g., `1.mp4`, `2a.mp4`, `2b.mp4`)
- Variants (a/b) used for branching paths
- Scene numbers: 1 through 8

## Cursor IDE Integration

### Recommended Extensions
- Biome formatter (for code formatting)
- Mermaid viewer (for diagram preview)
- File folding extension (for code organization)
- See `notes/cursor-setup.md` for complete list

### File Folding
- Configure Cursor to fold long files automatically
- Use folding for large HTML sections, CSS blocks, and documentation

